<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SnapEngage Diagnostic - callwithcarlos.com</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: #f8f9fa;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .diagnostic {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
        .code {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
            overflow-x: auto;
        }
        .test-button {
            background: #007cba;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #005a8b;
        }
        .log {
            background: #1a202c;
            color: #a0aec0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç SnapEngage API Key Diagnostic</h1>
        <p>This tool will help diagnose issues with your SnapEngage integration.</p>

        <div class="diagnostic">
            <h2>üìã Current Configuration</h2>
            <div id="current-config">
                <p><strong>API Key:</strong> <code>b7c9cc6a36a15486d0383e1e2ae75456</code></p>
                <p><strong>Expected Script URL:</strong> <code id="script-url">Loading...</code></p>
                <p><strong>Domain:</strong> <code>callwithcarlos.com</code></p>
            </div>
        </div>

        <div class="diagnostic">
            <h2>üß™ API Key Tests</h2>
            <p>Let's test different API key formats and sources:</p>
            
            <button class="test-button" onclick="testCurrentApiKey()">Test Current API Key</button>
            <button class="test-button" onclick="testDirectSnapEngage()">Test Direct SnapEngage</button>
            <button class="test-button" onclick="checkSnapEngageStatus()">Check SnapEngage Service</button>
            <button class="test-button" onclick="validateScriptUrl()">Validate Script URL</button>
        </div>

        <div class="diagnostic">
            <h2>üîß API Key Finder</h2>
            <p>If you're not sure about your API key, try these steps:</p>
            
            <div style="margin: 15px 0;">
                <label for="api-key-input">Enter your API key to test:</label><br>
                <input type="text" id="api-key-input" placeholder="Enter API key here..." style="width: 400px; padding: 8px; margin: 5px 0;">
                <button class="test-button" onclick="testCustomApiKey()">Test This Key</button>
            </div>

            <h3>üìñ How to Find Your API Key:</h3>
            <ol>
                <li>Login to your <strong>SnapEngage Dashboard</strong></li>
                <li>Go to <strong>Settings</strong> ‚Üí <strong>Get the Code</strong></li>
                <li>Look for the JavaScript code snippet</li>
                <li>Find the line that looks like: <code>se.src = '//storage.googleapis.com/code.snapengage.com/js/YOUR-API-KEY.js';</code></li>
                <li>Copy the API key from that URL (the part before .js)</li>
            </ol>
        </div>

        <div class="diagnostic">
            <h2>üìä Test Results</h2>
            <div id="test-results" class="log">
                <div class="info">[Diagnostic] Ready to test API keys...</div>
            </div>
        </div>

        <div class="diagnostic">
            <h2>üéØ Alternative Test Methods</h2>
            
            <h3>Method 1: Direct SnapEngage Script Test</h3>
            <div class="code">
&lt;script type="text/javascript"&gt;
(function() {
    var se = document.createElement('script');
    se.type = 'text/javascript';
    se.async = true;
    se.src = '//storage.googleapis.com/code.snapengage.com/js/YOUR-API-KEY.js';
    var done = false;
    se.onload = se.onreadystatechange = function() {
        if (!done && (!this.readyState || this.readyState === 'loaded' || this.readyState === 'complete')) {
            done = true;
            console.log('SnapEngage loaded successfully!');
        }
    };
    se.onerror = function() {
        console.error('Failed to load SnapEngage script');
    };
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(se, s);
})();
&lt;/script&gt;
            </div>

            <h3>Method 2: Widget ID Test</h3>
            <p>If you have a Widget ID, test if SnapEngage service is working:</p>
            <div style="margin: 15px 0;">
                <label for="widget-id-input">Enter your Widget ID:</label><br>
                <input type="text" id="widget-id-input" placeholder="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx" style="width: 400px; padding: 8px; margin: 5px 0;">
                <button class="test-button" onclick="testWidgetId()">Test Widget</button>
            </div>
        </div>

        <div class="diagnostic">
            <h2>üö® Common Issues & Solutions</h2>
            
            <h3>1. Invalid API Key</h3>
            <ul>
                <li>Verify the API key in your SnapEngage dashboard</li>
                <li>Make sure you're using the JavaScript snippet API key, not a REST API key</li>
                <li>Check for typos or missing characters</li>
            </ul>

            <h3>2. Account Issues</h3>
            <ul>
                <li>Ensure your SnapEngage account is active</li>
                <li>Check if you have the correct subscription plan</li>
                <li>Verify your account hasn't been suspended</li>
            </ul>

            <h3>3. Network Issues</h3>
            <ul>
                <li>Check if your hosting provider blocks external scripts</li>
                <li>Verify CDN access to storage.googleapis.com</li>
                <li>Test from different networks/devices</li>
            </ul>
        </div>
    </div>

    <script>
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('test-results');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = type;
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function testCurrentApiKey() {
            const apiKey = 'b7c9cc6a36a15486d0383e1e2ae75456';
            addLog('Testing current API key: ' + apiKey, 'info');
            testApiKey(apiKey);
        }

        function testCustomApiKey() {
            const apiKey = document.getElementById('api-key-input').value.trim();
            if (!apiKey) {
                addLog('‚ùå Please enter an API key to test', 'error');
                return;
            }
            addLog('Testing custom API key: ' + apiKey, 'info');
            testApiKey(apiKey);
        }

        function testApiKey(apiKey) {
            const scriptUrl = `//storage.googleapis.com/code.snapengage.com/js/${apiKey}.js`;
            addLog('Script URL: ' + scriptUrl, 'info');
            
            // Remove any existing SnapEngage scripts
            const existingScripts = document.querySelectorAll('script[src*="snapengage"]');
            existingScripts.forEach(script => script.remove());
            
            const script = document.createElement('script');
            script.type = 'text/javascript';
            script.async = true;
            script.src = scriptUrl;
            
            script.onload = function() {
                addLog('‚úÖ SnapEngage script loaded successfully!', 'success');
                setTimeout(() => {
                    if (typeof SnapEngage !== 'undefined') {
                        addLog('‚úÖ SnapEngage object is available', 'success');
                        
                        // Test a simple function
                        try {
                            SnapEngage.getWidgetId();
                            addLog('‚úÖ SnapEngage functions are working', 'success');
                        } catch (e) {
                            addLog('‚ö†Ô∏è SnapEngage loaded but functions may not be ready: ' + e.message, 'warning');
                        }
                    } else {
                        addLog('‚ö†Ô∏è Script loaded but SnapEngage object not found', 'warning');
                    }
                }, 1000);
            };
            
            script.onerror = function() {
                addLog('‚ùå Failed to load SnapEngage script - API key may be invalid', 'error');
                addLog('üí° Try getting a fresh API key from your SnapEngage dashboard', 'info');
            };
            
            document.head.appendChild(script);
        }

        function testDirectSnapEngage() {
            addLog('Testing direct connection to SnapEngage...', 'info');
            
            // Test if we can reach SnapEngage CDN
            fetch('https://storage.googleapis.com/code.snapengage.com/js/')
                .then(response => {
                    if (response.ok) {
                        addLog('‚úÖ SnapEngage CDN is accessible', 'success');
                    } else {
                        addLog('‚ö†Ô∏è SnapEngage CDN responded with status: ' + response.status, 'warning');
                    }
                })
                .catch(error => {
                    addLog('‚ùå Cannot reach SnapEngage CDN: ' + error.message, 'error');
                    addLog('üí° This might be a network/firewall issue', 'info');
                });
        }

        function checkSnapEngageStatus() {
            addLog('Checking SnapEngage service status...', 'info');
            
            // Test the public API
            fetch('https://www.snapengage.com/')
                .then(response => {
                    if (response.ok) {
                        addLog('‚úÖ SnapEngage main service is accessible', 'success');
                    } else {
                        addLog('‚ö†Ô∏è SnapEngage service responded with status: ' + response.status, 'warning');
                    }
                })
                .catch(error => {
                    addLog('‚ùå Cannot reach SnapEngage service: ' + error.message, 'error');
                });
        }

        function validateScriptUrl() {
            const apiKey = 'b7c9cc6a36a15486d0383e1e2ae75456';
            const scriptUrl = `https://storage.googleapis.com/code.snapengage.com/js/${apiKey}.js`;
            
            addLog('Validating script URL: ' + scriptUrl, 'info');
            
            fetch(scriptUrl)
                .then(response => {
                    if (response.ok) {
                        addLog('‚úÖ Script URL is valid and accessible', 'success');
                        return response.text();
                    } else {
                        addLog('‚ùå Script URL returned status: ' + response.status, 'error');
                        if (response.status === 404) {
                            addLog('üí° 404 error usually means invalid API key', 'info');
                        }
                        throw new Error('HTTP ' + response.status);
                    }
                })
                .then(scriptContent => {
                    if (scriptContent.includes('SnapEngage')) {
                        addLog('‚úÖ Script contains SnapEngage code', 'success');
                    } else {
                        addLog('‚ö†Ô∏è Script loaded but may not be valid SnapEngage code', 'warning');
                    }
                })
                .catch(error => {
                    addLog('‚ùå Failed to validate script URL: ' + error.message, 'error');
                });
        }

        function testWidgetId() {
            const widgetId = document.getElementById('widget-id-input').value.trim();
            if (!widgetId) {
                addLog('‚ùå Please enter a Widget ID to test', 'error');
                return;
            }
            
            addLog('Testing Widget ID: ' + widgetId, 'info');
            
            const apiUrl = `https://www.snapengage.com/public/api/v2/chat/${widgetId}`;
            
            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.statusCode === 1) {
                        addLog('‚úÖ Widget ID is valid!', 'success');
                        addLog('üìä Widget status: ' + (data.data.online === 'true' ? 'ONLINE' : 'OFFLINE'), 'info');
                        addLog('üìß Email required: ' + data.data.emailRequired, 'info');
                        addLog('üí¨ Message required: ' + data.data.messageRequired, 'info');
                    } else {
                        addLog('‚ö†Ô∏è Widget API responded but may have issues', 'warning');
                    }
                })
                .catch(error => {
                    addLog('‚ùå Widget ID test failed: ' + error.message, 'error');
                    addLog('üí° Widget ID may be invalid or SnapEngage service may be down', 'info');
                });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            const apiKey = 'b7c9cc6a36a15486d0383e1e2ae75456';
            const scriptUrl = `https://storage.googleapis.com/code.snapengage.com/js/${apiKey}.js`;
            document.getElementById('script-url').textContent = scriptUrl;
            
            addLog('üîç Diagnostic tool ready', 'success');
            addLog('üí° Click "Test Current API Key" to start diagnosis', 'info');
        });
    </script>
</body>
</html>